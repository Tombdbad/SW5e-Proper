// Improved SW5E Character Schema
export const characters = pgTable("characters", {
  // Identity & Meta
  id: serial("id").primaryKey(),
  userId: integer("user_id").notNull().references(() => users.id),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
  
  // Basic Character Info
  name: text("name").notNull(),
  species: text("species").notNull(),
  class: text("class").notNull(),
  subclass: text("subclass"),
  level: integer("level").notNull().default(1),
  background: text("background").notNull(),
  alignment: text("alignment").notNull(),
  
  // Core Stats
  abilityScores: json("ability_scores").notNull(), // { strength, dexterity, constitution, intelligence, wisdom, charisma }
  proficiencyBonus: integer("proficiency_bonus").notNull().default(2),
  
  // Health & Defense
  maxHp: integer("max_hp").notNull(),
  currentHp: integer("current_hp").notNull(),
  temporaryHp: integer("temporary_hp").notNull().default(0),
  armorClass: integer("armor_class").notNull(),
  
  // Force Powers
  maxForcePoints: integer("max_force_points").notNull().default(0),
  currentForcePoints: integer("current_force_points").notNull().default(0),
  forcePowers: json("force_powers"), // [{ name, level, description, castingTime, range, duration, usesRemaining, maxUses }]
  techPowers: json("tech_powers"), // Similar structure to forcePowers
  
  // Movement & Combat
  speed: integer("speed").notNull().default(30),
  initiative: integer("initiative"),
  
  // Proficiencies
  savingThrowProficiencies: json("saving_throw_proficiencies").notNull(), // Array of ability names
  skillProficiencies: json("skill_proficiencies").notNull(), // { skillName: proficiencyLevel (0=none, 1=proficient, 2=expertise) }
  toolProficiencies: json("tool_proficiencies"), // Array of tool names
  weaponProficiencies: json("weapon_proficiencies"), // Array of weapon types
  armorProficiencies: json("armor_proficiencies"), // Array of armor types
  languages: json("languages"), // Array of known languages
  
  // Equipment & Inventory
  credits: integer("credits").notNull().default(1000),
  equipment: json("equipment").notNull(), // Array of standard equipment items
  weapons: json("weapons"), // [{ name, damage, damageType, properties, equipped, proficient }]
  armor: json("armor"), // { name, type, armorClass, equipped }
  customItems: json("custom_items"), // For homebrew/custom items
  encumbrance: integer("encumbrance").default(0),
  carryingCapacity: integer("carrying_capacity"),
  
  // Character Development
  personalityTraits: json("personality_traits"), // Array of traits
  ideals: json("ideals"), // Array of ideals
  bonds: json("bonds"), // Array of bonds
  flaws: json("flaws"), // Array of flaws
  backstory: text("backstory"),
  notes: text("notes"),
  
  // Campaign Information
  experience: integer("experience").notNull().default(0),
  startingLocation: text("starting_location").notNull(),
  currentLocation: text("current_location"),
  factionReputations: json("faction_reputations"), // { factionName: reputationValue }
  
  // SW5E-specific
  forceAlignment: text("force_alignment"), // Light, Dark, Universal, etc.
  deployments: json("deployments"), // For soldier class
  modifications: json("modifications"), // For engineer class
  companionData: json("companion_data"), // For companions/pets
  
  // Conditions & Status Effects
  conditions: json("conditions"), // Array of current conditions
  exhaustionLevel: integer("exhaustion_level").default(0),
  
  // Customization Options
  feats: json("feats"), // Array of feat names or objects
  fighterManeuvers: json("fighter_maneuvers"), // For fighter class
  scholarFormulae: json("scholar_formulae"), // For scholar class
});